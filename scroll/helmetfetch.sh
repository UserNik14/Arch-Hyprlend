#!/bin/bash
#
#
#



## COLORS

if [ -x "$(command -v tput)" ]; then
	bold="$(tput bold 2> /dev/null)"
	black="$(tput setaf 0 2> /dev/null)"
	red="$(tput setaf 1 2> /dev/null)"
	green="$(tput setaf 2 2> /dev/null)"
	yellow="$(tput setaf 3 2> /dev/null)"
	blue="$(tput setaf 4 2> /dev/null)"
	magenta="$(tput setaf 5 2> /dev/null)"
	cyan="$(tput setaf 6 2> /dev/null)"
	white="$(tput setaf 7 2> /dev/null)"
	reset="$(tput sgr0 2> /dev/null)"
fi

label="${reset}${bold}${blue}"



## RAM

# il primo argomento dello script pu√≤ essere MiB oppure GiB
UNIT="${1:-MiB}"  # se non viene passato nulla, usa MiB di default

read RAM_USED RAM_TOTAL <<< $(free -m | awk '/^Mem:/ {print $3, $2}')

# calcola la percentuale
PERC=$(( RAM_USED * 100 / RAM_TOTAL ))

# converte da MiB a GiB
if [[ "$UNIT" == "GiB" ]]; then
    RAM_USED=$(printf '%.2f\n' $((10**2*$RAM_USED/1024))e-2)
    RAM_TOTAL=$(printf '%.2f\n' $((10**2*$RAM_TOTAL/1024))e-2)
fi



## SYSTEM INFO

SYSINFO=(
"${reset}${bold}        ___           __"
"${reset}${bold}       / _ | ________/ /"
"${reset}${bold}      / __ |/ __/ __/ _ \\"
"${reset}${bold}     /_/ |_/_/  \__/_//_/"
"${reset}${bold}    ÔëõÔëõ ÔëõÔëõ ÔëõÔëõ ÔëõÔëõ ÔëõÔëõ ÔëõÔëõ ÔëõÔëõ ÔëõÔëõ"
" ${label}Kernel:${reset}    $(uname -sr)"
"  ${label}Ram:${reset}       $(printf "%s/%s %s (%d%%)" "$RAM_USED" "$RAM_TOTAL" "$UNIT" "$PERC")"
"   ${label}Uptime:${reset}    $(uptime -p | sed 's/up //')"
"    ${label}Packages:${reset}  $(pacman -Q | wc -l)"
""
)



## PRINT OUTPUT

#read -r rows cols < <(stty size)
#echo "Numero di righe: $rows"
#echo "Numero di colonne: $cols"

if [ $(tput lines) -lt 13 ]; then
        for info in "${SYSINFO[@]:0:4}"; do
          echo "  $info"
        done
        exit
fi

if [ $(tput lines) -lt 18 ]; then
        for info in "${SYSINFO[@]:0:8}"; do
          echo "  $info"
        done
        exit
fi

#if [ -z "$DISPLAY" ] && [ -z "$WAYLAND_DISPLAY" ] || [ $(tput cols) -lt 68 ]; then
if [ "$XDG_SESSION_TYPE" = "tty" ] || [ $(tput cols) -lt 68 ]; then
	for info in "${SYSINFO[@]}"; do
	  echo "  $info"
	done
	exit
fi


IMAGE="[?25l[0m[38;2;184;183;182m‚ñó[38;2;206;205;204m‚ñÜ[38;2;190;189;189m‚ñÑ[0m [38;2;2;2;2m       [0m [38;2;241;204;77m‚ñÅ[38;2;254;235;100m‚ñÅ[38;2;254;230;99m‚ñÅ[38;2;254;231;99m‚ñÅ[38;2;250;228;96m‚ñÅ[0m [38;2;86;79;33m     [0m [38;2;231;230;229m‚ñÜ[38;2;243;243;243m‚ñÜ[38;2;239;239;238m‚ññ [0m
[38;2;119;118;117m‚ñù[38;2;134;132;131;48;2;167;164;163m‚ñè[38;2;248;247;247;48;2;191;189;188m‚ñù[0m[38;2;241;240;240m‚ññ  [0m [38;2;208;208;208m‚ñÉ[38;2;250;250;250m‚ñÑ[38;2;235;235;235m‚ñÜ[38;2;251;251;251m‚ñÜ[38;2;252;252;252;48;2;134;114;78m‚ñÜ[38;2;248;248;248;48;2;148;131;107m‚ñÖ[38;2;236;236;236;48;2;178;156;95m‚ñÑ[38;2;151;141;123;48;2;248;223;90m‚ñÖ[38;2;189;162;85;48;2;252;236;95m‚ññ[38;2;254;250;103;48;2;254;233;97m‚ñÖ[38;2;254;245;101;48;2;224;202;89m‚ñá[0m[38;2;243;235;97m‚ñá[38;2;233;227;134m‚ñÜ[38;2;218;217;209m‚ñÖ[38;2;247;247;247m‚ñÉ[38;2;162;162;162m‚ñÇ[7m[38;2;209;209;208m‚ñâ[0m[38;2;240;239;238;48;2;249;248;247m‚ñå[38;2;254;254;253;48;2;254;254;254m‚ñè[0m[38;2;228;227;227m‚ñå [0m
 [38;2;166;163;161m‚ñù[38;2;168;165;163;48;2;174;171;170m‚ñâ[38;2;250;250;250;48;2;200;199;198m‚îó[0m[38;2;161;161;161m‚ññ[38;2;223;222;221m‚ñó[38;2;175;174;174;48;2;251;250;250m‚ñò[48;2;254;254;254m       [38;2;252;252;252;48;2;207;207;207m‚ñá[38;2;241;241;241;48;2;128;123;113m‚ññ[38;2;120;108;91;48;2;240;219;78m‚ññ[38;2;254;244;86;48;2;254;250;96m‚ñÑ[38;2;254;243;86m‚ñÑ[38;2;254;242;85;48;2;254;249;96m‚ñÑ[38;2;179;171;133;48;2;248;235;87m‚ñù[38;2;157;148;113;48;2;241;241;241m‚ññ[38;2;254;254;254;48;2;253;253;253m‚ñá[38;2;251;251;251;48;2;135;135;135m‚ñÜ[38;2;243;242;241;48;2;252;251;250m‚ñò[38;2;254;254;254;48;2;250;249;249m‚ñâ[0m[38;2;193;192;191m‚ñç [0m
  [7m[38;2;139;137;135m‚ññ[0m[38;2;190;188;186;48;2;169;165;162m‚ñù[38;2;131;131;131;48;2;235;234;233m‚ñù[38;2;235;234;233;48;2;207;207;206m‚ñá[38;2;252;251;250;48;2;244;243;242m‚ñù[38;2;244;243;242;48;2;251;251;250m‚ñÖ[38;2;242;240;239;48;2;253;253;253m‚ñÉ[38;2;245;244;243;48;2;254;253;253m‚ñÇ[38;2;248;247;246;48;2;253;253;253m‚ñÇ[48;2;254;254;254m   [38;2;254;253;253m‚ñÅ[38;2;252;252;252;48;2;227;227;226m‚ñâ[38;2;210;209;209;48;2;108;102;94m‚ññ[38;2;144;116;64;48;2;248;220;68m‚ññ[38;2;245;184;45;48;2;254;228;71m‚ñÇ[38;2;244;182;44;48;2;254;227;70m‚ñÇ[38;2;244;181;44;48;2;254;225;69m‚ñÇ[38;2;143;136;119;48;2;229;188;61m‚ñù[38;2;147;147;146;48;2;250;250;250m‚ññ[38;2;240;239;238;48;2;254;254;254m‚ñÅ[38;2;236;235;234;48;2;244;243;242m‚ñó[38;2;249;248;248;48;2;234;233;232m‚ñâ[0m[38;2;177;176;175m‚ñè [0m
 [38;2;0;0;0m [0m [7m[38;2;170;161;155m‚ññ[0m[38;2;224;221;219;48;2;180;166;155m‚ñù[38;2;249;249;248;48;2;239;237;235m‚ñö[38;2;218;216;216;48;2;236;235;234m‚ñÇ[38;2;216;214;211;48;2;231;229;228m‚ñÑ[38;2;217;215;213;48;2;228;226;225m‚ñÑ[38;2;224;223;221;48;2;235;234;233m‚ñÖ[38;2;230;229;228;48;2;240;239;238m‚ñÑ[38;2;239;238;237;48;2;250;249;249m‚ññ[38;2;226;226;226;48;2;253;253;253m‚ñó[38;2;120;120;122;48;2;237;236;236m‚ñÖ[38;2;93;94;96;48;2;229;228;228m‚ñá[38;2;61;63;67;48;2;190;189;188m‚ñá[38;2;50;51;56;48;2;119;118;117m‚ñá[38;2;49;48;51;48;2;117;88;40m‚ñá[38;2;51;49;51;48;2;172;120;30m‚ñá[38;2;51;50;52;48;2;170;118;30m‚ñá[38;2;50;50;53;48;2;169;117;31m‚ñá[48;2;143;102;36m‚ñá[48;2;123;122;122m‚ñá[38;2;51;51;52;48;2;175;174;173m‚ñá[38;2;218;216;215;48;2;87;87;88m‚ñù[38;2;225;224;223;48;2;133;131;130m‚ñâ[0m [38;2;29;29;29m [0m
 [38;2;0;0;0m [38;2;184;130;42m‚ñó[7m[38;2;202;145;51m‚ñò[0m[38;2;242;190;55;48;2;203;151;88m‚ñá[38;2;243;226;83;48;2;237;223;198m‚ñÜ[38;2;121;115;93;48;2;172;171;170m‚ñÜ[38;2;126;126;125;48;2;194;192;190m‚ññ[38;2;199;196;194;48;2;207;204;202m‚ññ[38;2;209;207;206;48;2;215;213;212m‚ñÑ[38;2;214;213;212;48;2;221;220;219m‚ñÑ[38;2;221;220;219;48;2;231;230;229m‚ñÖ[38;2;219;219;219;48;2;87;88;91m‚ñå[38;2;68;68;69;48;2;93;93;93m‚ñÖ[38;2;63;64;66;48;2;80;80;80m‚ñÖ[38;2;59;61;66;48;2;65;65;66m‚ñÖ[38;2;57;60;69;48;2;59;60;63m‚ñÉ[38;2;56;59;65;48;2;57;57;60m‚ñÇ[38;2;57;57;61;48;2;57;57;59m‚ññ[38;2;57;57;60;48;2;57;57;58m‚ñÑ[38;2;57;59;64;48;2;58;58;60m‚ñÉ[38;2;57;60;69;48;2;58;58;61m‚ñÉ[38;2;56;59;65;48;2;58;58;60m‚ñÉ[38;2;57;57;59;48;2;57;56;57m‚ñå[38;2;60;60;61;48;2;49;51;57m‚ñâ[38;2;79;80;83;48;2;193;189;180m‚ñç[0m[38;2;191;166;70m‚ñÖ[0m [0m
  [38;2;184;128;37;48;2;108;79;36m‚ñä[38;2;53;50;47;48;2;141;96;33m‚ñá[38;2;62;55;48;48;2;186;131;39m‚ññ[38;2;239;177;45;48;2;253;221;69m‚ññ[38;2;240;205;67;48;2;91;84;74m‚ñã[38;2;82;82;81;48;2;145;144;144m‚ñã[38;2;180;178;177;48;2;194;192;191m‚ñé[38;2;199;197;196;48;2;204;201;200m‚ññ[38;2;206;204;203;48;2;210;208;207m‚ñÖ[38;2;210;209;208;48;2;217;215;214m‚ñä[38;2;169;169;171;48;2;52;54;60m‚ñé[38;2;55;56;59;48;2;57;57;60m‚ññ[38;2;55;63;78;48;2;57;59;66m‚ñó[38;2;62;211;219;48;2;57;87;101m‚ñÑ[38;2;65;243;245;48;2;55;64;81m‚ñá[38;2;65;235;238;48;2;57;101;111m‚ñÖ[38;2;57;97;108;48;2;55;58;66m‚ñè[38;2;55;61;75;48;2;55;58;65m‚ñó[38;2;64;236;241;48;2;55;81;99m‚ñó[38;2;65;239;242;48;2;56;64;82m‚ñá[38;2;65;230;233;48;2;57;84;96m‚ñÜ[38;2;58;105;115;48;2;55;59;64m‚ñè[38;2;57;57;59;48;2;62;62;65m‚ñå[38;2;60;62;67;48;2;179;176;173m‚ñå[38;2;89;86;71;48;2;241;200;61m‚ñä[0m[38;2;235;170;49m‚ñã[0m
 [7m[38;2;119;91;49m‚ñâ[0m[38;2;196;137;40;48;2;118;90;46m‚ñä[38;2;94;75;49;48;2;54;51;49m‚ñÅ[38;2;89;72;48;48;2;194;134;36m‚ñå[38;2;242;171;40;48;2;218;151;33m‚ñù[38;2;227;159;38;48;2;76;66;52m‚ñã[38;2;62;62;61;48;2;127;127;126m‚ñã[38;2;170;169;168;48;2;189;187;186m‚ñé[38;2;196;194;193;48;2;199;197;195m‚ñç[38;2;203;202;201;48;2;201;199;198m‚ñù[38;2;206;205;204;48;2;170;170;171m‚ñâ[38;2;86;90;99;48;2;50;52;59m‚ñè[38;2;54;55;59;48;2;55;57;63m‚ñã[38;2;54;71;86;48;2;61;214;224m‚ñä[38;2;65;253;253;48;2;65;254;254m‚ñè[38;2;65;254;254;48;2;66;254;254m‚îÄ [38;2;64;234;239;48;2;54;65;77m‚ñé[38;2;53;62;79;48;2;50;110;139m‚ñâ[38;2;58;188;204;48;2;65;251;252m‚ñè[48;2;66;254;254m [38;2;66;254;254;48;2;67;254;254m‚ñã[38;2;65;232;237;48;2;55;64;71m‚ñé[38;2;56;57;59;48;2;60;60;64m‚ñç[38;2;190;189;189;48;2;85;85;87m‚îÉ[38;2;72;65;57;48;2;217;152;40m‚ñä[0m[38;2;213;150;45m‚ñã[0m
 [38;2;0;0;0m [38;2;194;136;44m‚ñù[38;2;123;105;80;48;2;195;136;42m‚ñÇ[38;2;169;113;27;48;2;189;131;37m‚ñó[38;2;113;78;29;48;2;191;130;29m‚ñÇ[38;2;149;106;37;48;2;62;59;57m‚ñò[38;2;76;75;75;48;2;159;157;156m‚ñò[38;2;181;179;178;48;2;189;187;186m‚ñç[38;2;193;191;190;48;2;196;194;192m‚ññ[38;2;198;196;195;48;2;199;198;197m‚ñç[38;2;204;202;201;48;2;97;100;106m‚ñä[38;2;45;48;56;48;2;51;52;55m‚ñé[38;2;53;54;58;48;2;53;55;62m‚ñã[38;2;53;65;77;48;2;58;172;184m‚ñä[38;2;62;218;223;48;2;65;252;253m‚ñÅ[38;2;65;254;254;48;2;66;254;254m‚îô[38;2;56;127;137;48;2;65;248;249m‚ñó[38;2;55;111;121;48;2;52;58;68m‚ñè[38;2;53;59;74;48;2;50;96;120m‚ñâ[38;2;57;171;185;48;2;66;252;252m‚ññ[48;2;66;254;254m [38;2;57;124;133;48;2;66;248;249m‚ñó[38;2;56;103;112;48;2;54;57;62m‚ñè[38;2;60;60;62;48;2;44;46;53m‚ñä[38;2;192;188;185;48;2;95;88;81m‚îÉ[0m[7m[38;2;137;99;45m‚ñÇ[0m [0m
 [38;2;0;0;0m  [0m [7m[38;2;216;210;205m‚ññ[0m[38;2;164;159;155;48;2;68;57;47m‚ñá[38;2;157;151;146;48;2;128;125;123m‚ñá[38;2;147;144;141;48;2;163;160;157m‚ñÉ[38;2;160;157;155;48;2;177;174;173m‚ñÑ[38;2;169;166;165;48;2;185;183;182m‚ñÑ[38;2;174;172;170;48;2;191;189;188m‚ñÑ[38;2;189;188;187;48;2;88;90;95m‚ñä[38;2;58;58;60;48;2;49;49;52m‚ï±[38;2;51;51;53;48;2;53;53;56m‚ñÖ[38;2;51;51;55;48;2;52;55;62m‚ñÑ[38;2;51;54;60;48;2;57;152;162m‚ñÜ[38;2;51;57;65;48;2;64;237;240m‚ñÜ[38;2;51;53;58;48;2;54;94;104m‚ñá[38;2;51;51;54;48;2;53;54;59m‚ñÖ[48;2;52;55;62m‚ñÑ[38;2;52;54;60;48;2;55;119;132m‚ñÜ[38;2;52;56;63;48;2;64;238;241m‚ñÜ[38;2;53;55;59;48;2;55;97;106m‚ñá[38;2;54;54;56;48;2;59;58;60m‚ñä[38;2;126;126;128;48;2;58;59;62m‚ñó[0m[38;2;149;148;147m‚ñò  [0m
 [38;2;0;0;0m   [0m [7m[38;2;213;211;209m‚ññ[0m[38;2;195;191;188;48;2;164;159;155m‚ññ[38;2;156;151;148;48;2;139;135;131m‚ññ[38;2;140;134;130;48;2;147;143;140m‚ñÑ[38;2;151;145;140;48;2;159;155;152m‚ññ[38;2;164;159;156;48;2;166;163;161m‚ñÖ[38;2;176;173;171;48;2;167;164;161m‚ñù[38;2;58;59;63;48;2;165;163;163m‚ñù[38;2;91;93;97;48;2;51;52;56m‚ñÅ[38;2;46;50;60;48;2;50;50;53m‚ñÇ[38;2;44;48;57;48;2;50;51;54m‚ñÅ[38;2;46;48;55;48;2;51;51;54m‚ñÅ[38;2;45;48;56;48;2;51;51;53m‚ñÅ[38;2;45;50;60;48;2;51;51;54m‚ñÅ[38;2;45;51;62;48;2;51;52;54m‚ñÅ[38;2;47;51;60;48;2;52;52;55m‚ñÅ[38;2;43;46;51m‚ñÅ[38;2;59;60;62;48;2;53;53;56m‚ñÅ[38;2;159;158;158;48;2;75;75;77m‚îé[0m[38;2;138;137;137m‚ñò   [0m
 [38;2;0;0;0m    [0m [7m[38;2;170;166;163m‚ñÑ[38;2;133;117;102m‚ñÅ[0m[38;2;132;109;89;48;2;133;123;114m‚ñÉ[38;2;143;127;113;48;2;148;138;131m‚ñÑ[38;2;154;139;127;48;2;161;152;145m‚ñÑ[38;2;160;147;136;48;2;165;157;152m‚ñÉ[38;2;169;153;140;48;2;168;162;158m‚ñÉ[38;2;180;167;159;48;2;133;132;132m‚ñá[38;2;179;164;154;48;2;57;58;62m‚ñá[48;2;50;53;58m‚ñá[38;2;179;164;153;48;2;49;51;56m‚ñá[38;2;177;164;154;48;2;49;51;57m‚ñá[38;2;174;164;158;48;2;49;53;59m‚ñá[38;2;172;164;158;48;2;50;53;60m‚ñá[38;2;174;165;160;48;2;52;55;60m‚ñá[38;2;174;166;160;48;2;58;58;59m‚ñá[0m[7m[38;2;142;138;135m‚ñó[0m [38;2;75;74;74m    [0m
 [38;2;0;0;0m      [0m [7m[38;2;119;84;46m‚ñá[38;2;129;99;69m‚ñÖ[38;2;154;123;92m‚ñÑ[38;2;160;127;96m‚ñÉ[38;2;169;131;97m‚ñÉ[38;2;168;127;92m‚ñÉ[38;2;173;130;91m‚ñÉ[38;2;175;132;93m‚ñÉ[38;2;177;135;97m‚ñÉ[38;2;178;139;105m‚ñÉ[38;2;171;138;108m‚ñÉ[38;2;160;134;112m‚ñÉ[38;2;148;132;119m‚ñÑ[38;2;110;98;88m‚ñÜ[0m [38;2;0;0;0m     [0m[?25h"



# conta le righe dell'immagine
IMAGE_HEIGHT=$(echo "$IMAGE" | wc -l)
SYSINFO_COUNT=${#SYSINFO[@]}

# calcola l'offset per centrare le specifiche
OFFSET=$(( (IMAGE_HEIGHT - SYSINFO_COUNT) / 2 ))

# inizializza array FETCH
FETCH=()

# accumula in FETCH
i=0
while IFS= read -r line; do
  if [ $i -ge $OFFSET ] && [ $i -lt $((OFFSET + SYSINFO_COUNT)) ]; then
    FETCH+=("$line  ${SYSINFO[$((i - OFFSET))]}")
  else
    FETCH+=("$line")
  fi
  i=$((i + 1))
done <<< "$IMAGE"



# nascondi cursore
printf '\e[?25l'

# ritardo
delay=0.002

cursor=$'\e[0m‚ñë‚ñë‚ñí‚ñì'

# tokenizza una riga in escape CSI + caratteri singoli
tokenize() {
  local s=$1; local -n T=$2
  T=()
  while [[ -n $s ]]; do
    if [[ $s =~ ^(\[[0-9;]*m)(.*) ]]; then
      T+=( "${BASH_REMATCH[1]}" )
      s=${BASH_REMATCH[2]}
    else
      T+=( "${s:0:1}" )
      s=${s:1}
    fi
  done
}

print_with_cursor() {
  local line=$1
  local -a tokens
  local prefix=""  # qui accumulo in ordine escape+testo
  tokenize "$line" tokens

  for tok in "${tokens[@]}"; do
    prefix+="$tok"
    # se √® carattere visibile (non inizio con ESC[), faccio il frame
    if [[ ! $tok =~ ^\[ ]]; then
      printf '\r%s%s\e[K' "$prefix" "$cursor"
      read -t "$delay"
    fi
  done

  # frame finale (tutta la riga senza cursor)
  printf '\r%s\e[K\n' "$prefix"
}

# stampa a schermo
for L in "${FETCH[@]}"; do
  print_with_cursor "$L"
done

# ripristina cursore
printf '\e[?25h'
