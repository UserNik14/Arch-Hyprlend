#!/bin/bash
#
#
#



## COLORS

if [ -x "$(command -v tput)" ]; then
	bold="$(tput bold 2> /dev/null)"
	black="$(tput setaf 0 2> /dev/null)"
	red="$(tput setaf 1 2> /dev/null)"
	green="$(tput setaf 2 2> /dev/null)"
	yellow="$(tput setaf 3 2> /dev/null)"
	blue="$(tput setaf 4 2> /dev/null)"
	magenta="$(tput setaf 5 2> /dev/null)"
	cyan="$(tput setaf 6 2> /dev/null)"
	white="$(tput setaf 7 2> /dev/null)"
	reset="$(tput sgr0 2> /dev/null)"
fi

label="${reset}${bold}${blue}"



## RAM

# il primo argomento dello script pu√≤ essere MiB oppure GiB
UNIT="${1:-MiB}"  # se non viene passato nulla, usa MiB di default

read RAM_USED RAM_TOTAL <<< $(free -m | awk '/^Mem:/ {print $3, $2}')

# calcola la percentuale
PERC=$(( RAM_USED * 100 / RAM_TOTAL ))

# converte da MiB a GiB
if [[ "$UNIT" == "GiB" ]]; then
    RAM_USED=$(printf '%.2f\n' $((10**2*$RAM_USED/1024))e-2)
    RAM_TOTAL=$(printf '%.2f\n' $((10**2*$RAM_TOTAL/1024))e-2)
fi



## SYSTEM INFO

SYSINFO=(
"${reset}${bold}        ___           __"
"${reset}${bold}       / _ | ________/ /"
"${reset}${bold}      / __ |/ __/ __/ _ \\"
"${reset}${bold}     /_/ |_/_/  \__/_//_/"
"${reset}${bold}    ÔëõÔëõ ÔëõÔëõ ÔëõÔëõ ÔëõÔëõ ÔëõÔëõ ÔëõÔëõ ÔëõÔëõ ÔëõÔëõ"
" ${label}Kernel:${reset}    $(uname -sr)"
"  ${label}Ram:${reset}       $(printf "%s/%s %s (%d%%)" "$RAM_USED" "$RAM_TOTAL" "$UNIT" "$PERC")"
"   ${label}Uptime:${reset}    $(uptime -p | sed 's/up //')"
"    ${label}Packages:${reset}  $(pacman -Q | wc -l)"
""
""
)



## PRINT OUTPUT

#read -r rows cols < <(stty size)
#echo "Numero di righe: $rows"
#echo "Numero di colonne: $cols"

if [ $(tput lines) -lt 13 ]; then
        for info in "${SYSINFO[@]:0:4}"; do
          echo "  $info"
        done
        exit
fi

if [ $(tput lines) -lt 18 ]; then
        for info in "${SYSINFO[@]:0:8}"; do
          echo "  $info"
        done
        exit
fi

#if [ -z "$DISPLAY" ] && [ -z "$WAYLAND_DISPLAY" ] || [ $(tput cols) -lt 68 ]; then
if [ "$XDG_SESSION_TYPE" = "tty" ] || [ $(tput cols) -lt 68 ]; then
	for info in "${SYSINFO[@]}"; do
	  echo "  $info"
	done
	exit
fi


IMAGE="[?25l[0m  [38;2;0;0;0m  [0m [38;2;215;188;93m‚ñÅ[38;2;241;203;80m‚ñÇ[38;2;218;180;65m‚ñÑ[38;2;212;168;48m‚ñÖ[38;2;236;186;47m‚ñÖ[38;2;227;177;42m‚ñÜ[38;2;237;182;43m‚ñÜ[38;2;232;178;44m‚ñá[38;2;235;176;41;48;2;121;107;73m‚ñá[38;2;233;172;39;48;2;225;197;123m‚ñá[38;2;232;169;38;48;2;231;196;114m‚ñá[0m[38;2;232;171;39m‚ñá[38;2;213;156;44m‚ñÜ[38;2;200;147;54m‚ññ       [0m
  [38;2;162;139;61m‚ñó[38;2;235;197;70m‚ñÖ[38;2;245;205;61;48;2;161;141;75m‚ñá[38;2;245;209;106;48;2;245;207;70m‚ñÑ[38;2;231;169;45;48;2;241;197;66m‚ñó[38;2;193;123;77;48;2;234;176;40m‚ñÉ[38;2;106;55;41;48;2;217;151;56m‚ñÇ[38;2;104;61;49;48;2;217;146;56m‚ñÉ[38;2;102;62;48;48;2;217;144;53m‚ñÑ[38;2;85;57;55;48;2;206;132;56m‚ñÑ[38;2;68;53;61;48;2;194;119;68m‚ñÑ[38;2;68;50;58;48;2;197;123;82m‚ñÖ[38;2;57;46;55;48;2;184;110;75m‚ñÖ[38;2;54;47;62;48;2;177;103;62m‚ñÖ[38;2;74;55;60;48;2;199;127;71m‚ñÑ[38;2;180;107;62;48;2;228;166;56m‚ññ[38;2;232;170;41;48;2;226;162;51m‚ñä[0m[38;2;159;115;50m‚ñã      [0m
 [38;2;120;106;55m‚ñó[38;2;199;168;64;48;2;242;197;39m‚ñò[38;2;246;206;96;48;2;242;200;45m‚ñç[38;2;243;200;40;48;2;243;206;80m‚ñä[38;2;244;210;126;48;2;238;188;54m‚ñå[38;2;222;156;67;48;2;125;73;45m‚ñä[38;2;220;220;222;48;2;112;84;81m‚ñó[38;2;160;156;164;48;2;43;44;57m‚ñé[38;2;21;21;37;48;2;52;52;61m‚ñÜ[38;2;20;20;34;48;2;48;49;55m‚ñá[38;2;18;18;30;48;2;23;23;34m‚ñá[38;2;17;19;35;48;2;18;18;28m‚ñÇ[38;2;19;22;53;48;2;19;19;32m‚ñÇ[38;2;95;110;154;48;2;20;23;48m‚ñÅ[38;2;108;118;156m‚ñÅ[38;2;36;37;59;48;2;138;142;154m‚ñã[38;2;132;122;129;48;2;153;92;62m‚ñé[38;2;216;154;93;48;2;230;167;44m‚ñç[38;2;221;158;57;48;2;125;92;44m‚ñâ[0m[38;2;48;44;40m‚ñÖ     [0m
 [7m[38;2;166;145;81m‚ñã[0m[38;2;92;76;64;48;2;239;189;36m‚ñÉ[38;2;170;117;48;48;2;240;191;45m‚ññ[38;2;242;193;31;48;2;241;199;57m‚ñâ[38;2;242;200;88;48;2;236;182;41m‚ñã[38;2;223;161;78;48;2;129;82;77m‚ñä[38;2;56;32;40;48;2;69;72;105m‚ñã[38;2;122;140;186;48;2;33;38;79m‚ñó[38;2;236;243;248;48;2;49;56;101m‚ñÖ[38;2;238;245;248;48;2;50;58;101m‚ñÖ[38;2;140;149;183;48;2;19;24;57m‚ññ[38;2;18;20;44;48;2;19;23;61m‚ñä[38;2;30;45;108;48;2;170;188;215m‚ñä[38;2;245;251;252;48;2;198;211;226m‚ñá[38;2;246;251;252;48;2;218;226;234m‚ñá[38;2;171;184;208;48;2;46;59;122m‚ñç[38;2;156;158;175;48;2;122;79;65m‚ñå[38;2;192;135;128;48;2;226;164;74m‚ñå[38;2;230;162;32;48;2;227;160;60m‚ñç[38;2;179;123;44;48;2;59;54;52m‚ñé[0m[38;2;51;48;46m‚ñé    [0m
 [7m[38;2;51;50;50m‚ñè[0m[38;2;119;118;121;48;2;87;84;86m‚î´[38;2;165;115;33;48;2;74;45;32m‚ñù[38;2;235;186;36;48;2;240;189;27m‚ñè[38;2;241;194;42;48;2;240;194;69m‚ñé[38;2;232;173;46;48;2;220;162;128m‚ñã[38;2;146;100;104;48;2;53;34;56m‚ñé[38;2;127;145;191;48;2;31;42;99m‚ñù[38;2;54;67;121;48;2;237;245;248m‚ñÉ[38;2;55;65;112;48;2;240;246;248m‚ñÉ[38;2;144;155;185;48;2;18;23;59m‚ñò[38;2;16;17;33;48;2;17;19;44m‚ñÑ[38;2;18;19;41;48;2;26;39;99m‚ñÖ[38;2;20;24;60;48;2;178;191;216m‚ñÖ[38;2;20;23;55;48;2;193;202;217m‚ñÖ[38;2;18;20;41;48;2;37;47;100m‚ñÜ[38;2;133;134;148;48;2;65;39;34m‚ñä[38;2;164;96;72;48;2;218;151;87m‚ñã[38;2;229;162;39;48;2;228;163;72m‚ñä[38;2;197;135;50;48;2;35;31;30m‚ñå[0m [38;2;35;33;30m    [0m
 [7m[38;2;41;40;40m‚ñç[0m[38;2;31;30;31;48;2;43;43;45m‚ñÜ[38;2;40;28;23;48;2;59;20;9m‚ñã[38;2;97;45;13;48;2;237;179;23m‚ñè[38;2;242;193;65;48;2;240;186;30m‚ñù[38;2;230;168;57;48;2;235;180;42m‚ñù[38;2;202;138;85;48;2;84;46;36m‚ñå[38;2;59;30;32;48;2;26;21;36m‚ñÅ[38;2;55;56;73;48;2;19;19;37m‚ñÇ[38;2;52;54;63;48;2;18;19;34m‚ñÇ[38;2;61;59;63;48;2;17;17;29m‚ñÇ[38;2;60;54;58;48;2;16;15;28m‚ñÉ[38;2;75;59;66;48;2;16;17;28m‚ñÉ[38;2;80;56;62;48;2;16;16;28m‚ñÑ[38;2;98;62;58;48;2;21;22;34m‚ñÑ[38;2;140;72;45;48;2;42;42;61m‚ñÉ[38;2;191;121;71;48;2;88;59;62m‚ñÉ[38;2;168;98;82;48;2;222;157;67m‚ñò[38;2;227;157;40;48;2;221;151;55m‚ñã[0m[38;2;208;147;64m‚ñò     [0m
  [38;2;149;119;55m‚ñù[38;2;214;135;22;48;2;108;49;14m‚ñÜ[38;2;192;101;14;48;2;228;155;20m‚ñé[38;2;225;147;17;48;2;234;172;20m‚ñÉ[38;2;227;152;16;48;2;235;174;28m‚ñÉ[38;2;228;165;69;48;2;231;165;27m‚ñù[38;2;227;163;53;48;2;113;56;35m‚ñÜ[38;2;229;169;65;48;2;109;58;46m‚ñÖ[38;2;228;168;62;48;2;119;62;43m‚ñÖ[38;2;231;166;51;48;2;134;68;40m‚ñÖ[38;2;226;157;46;48;2;129;58;27m‚ñÜ[38;2;227;160;44;48;2;153;79;46m‚ñÜ[38;2;226;155;49;48;2;159;85;58m‚ñá[38;2;225;153;32;48;2;210;143;95m‚ñÜ[38;2;223;146;27;48;2;227;160;74m‚ñÜ[38;2;213;129;31;48;2;229;162;35m‚ñÑ[0m[7m[38;2;214;141;34m‚ñÇ[0m[38;2;209;138;47m‚ñò[0m [38;2;1;1;1m     [0m
  [38;2;0;0;0m [38;2;168;114;40m‚ñù[7m[38;2;205;121;21m‚ñÉ[0m[38;2;100;70;52;48;2;207;115;20m‚ñÅ[38;2;197;90;19;48;2;211;120;16m‚ñÖ[38;2;197;81;17;48;2;215;129;21m‚ñÖ[38;2;198;88;27;48;2;220;140;24m‚ñÖ[38;2;106;71;63;48;2;206;106;17m‚ñÅ[38;2;154;67;45;48;2;215;124;19m‚ñÉ[38;2;166;70;33;48;2;216;124;20m‚ñÑ[38;2;172;76;36;48;2;214;117;18m‚ñÑ[38;2;115;46;38;48;2;199;101;27m‚ïå[0m[7m[38;2;203;99;22m‚îÄ[0m[38;2;103;56;44;48;2;206;107;21m‚îÅ[0m[38;2;216;121;25m‚ñÑ[38;2;175;116;48m‚ññ        [0m
  [38;2;0;0;0m    [0m [38;2;189;151;59m‚ñó[38;2;232;173;28m‚ñÖ[38;2;236;180;55;48;2;148;103;58m‚ñá[38;2;233;166;30;48;2;226;131;14m‚ñÜ[38;2;230;156;24;48;2;223;124;8m‚ñá[38;2;228;156;27;48;2;226;137;17m‚ñÜ[38;2;227;154;26;48;2;227;136;18m‚ñá[38;2;227;155;28;48;2;226;146;24m‚ñÜ[38;2;227;154;28;48;2;228;147;24m‚ñá[38;2;227;155;32;48;2;227;157;45m‚ñå[38;2;222;154;63;48;2;105;75;51m‚ñä[0m[38;2;130;111;105m‚ñÑ[38;2;104;93;89m‚ñÑ[38;2;107;104;102m‚ñÅ     [0m
  [38;2;0;0;0m   [0m [38;2;159;154;155m‚ñÑ[7m[38;2;169;147;128m‚ñò[0m[38;2;186;141;100;48;2;235;173;38m‚ñÜ[38;2;235;175;28;48;2;237;180;40m‚ñÉ[38;2;234;174;35;48;2;233;165;23m‚ñç[38;2;230;161;23;48;2;229;159;25m‚ñã[38;2;228;156;24;48;2;228;158;26m‚ñÅ[38;2;226;156;25m‚ñÉ[38;2;226;155;25;48;2;227;157;27m‚ñÉ[38;2;226;153;25;48;2;226;155;28m‚ñÇ[38;2;227;157;39;48;2;226;154;29m‚ñù[38;2;219;150;53;48;2;133;103;79m‚ñâ[0m[7m[38;2;112;101;99m‚ñÅ[0m[38;2;83;61;55;48;2;119;107;104m‚ñò[38;2;53;47;47;48;2;138;135;138m‚ñÑ[0m[38;2;53;47;46m‚ñá[38;2;45;44;45m‚ñÜ[38;2;41;40;40m‚ñÑ  [0m
  [38;2;0;0;0m [38;2;64;62;62m‚ñÉ[38;2;85;79;80m‚ñÑ[38;2;63;53;52;48;2;151;150;151m‚ñÑ[38;2;69;53;48;48;2;140;135;137m‚ñÇ[0m[7m[38;2;127;99;86m‚ñó[38;2;149;95;69m‚ññ[0m[38;2;157;71;10;48;2;229;160;21m‚ñè[38;2;235;170;24;48;2;230;162;19m‚ñò[38;2;224;147;19;48;2;227;155;20m‚ñÑ[38;2;222;143;22;48;2;226;152;23m‚ñÑ[38;2;222;142;22;48;2;225;150;24m‚ñÑ[38;2;221;140;21;48;2;225;149;23m‚ñÑ[38;2;221;139;21;48;2;225;147;23m‚ñÑ[38;2;220;137;22;48;2;224;145;24m‚ñÑ[0m[38;2;207;135;41m‚ñâ [7m[38;2;47;39;36m‚ñå[0m[38;2;52;43;41;48;2;24;14;13m‚ñù[38;2;28;26;27;48;2;54;51;53m‚ñÜ[38;2;170;144;27;48;2;53;49;39m‚ñÇ[38;2;208;178;47;48;2;89;83;63m‚ñÜ[0m[38;2;133;125;102m‚ñÖ[38;2;123;123;124m‚ññ[0m
  [7m[38;2;47;45;42m‚ñä[0m[38;2;191;176;105;48;2;81;79;72m‚ñÇ[38;2;201;176;40;48;2;110;108;104m‚ñÇ[38;2;61;57;50;48;2;46;44;45m‚ñé[38;2;64;56;56;48;2;53;34;28m‚ñå[0m[38;2;59;46;40m‚ñé[38;2;94;58;35m‚ñù[38;2;93;53;29;48;2;202;116;16m‚ññ[38;2;223;139;17;48;2;227;154;18m‚ñÇ[38;2;216;130;26;48;2;221;139;22m‚ñÉ[38;2;213;127;27;48;2;218;134;22m‚ñÉ[38;2;212;125;28;48;2;218;133;23m‚ñÉ[38;2;211;124;29;48;2;217;132;24m‚ñÉ[38;2;209;122;30;48;2;216;131;24m‚ñÉ[38;2;196;130;58;48;2;213;129;27m‚ñÅ[0m[38;2;211;135;36m‚ñò [0m [7m[38;2;39;37;35m‚ñÖ[38;2;52;45;36m‚ñÑ[0m[38;2;116;107;97;48;2;195;158;31m‚ñÜ[0m[7m[38;2;147;134;90m‚ï∫[0m[38;2;63;62;56m‚ñù[7m[38;2;123;122;121m‚ñÉ[0m
 [38;2;134;133;133m‚ñó[38;2;110;109;108;48;2;152;151;151m‚ñò[0m[7m[38;2;162;140;68m‚ñÇ[0m[38;2;122;101;62;48;2;224;194;27m‚ñÉ[38;2;179;157;65;48;2;63;55;32m‚ñä[0m[7m[38;2;36;32;31m‚ñÑ[0m [38;2;0;0;0m [0m [7m[38;2;183;105;24m‚ñÑ[38;2;200;117;40m‚ñÉ[38;2;189;112;41m‚ñÉ[38;2;198;118;43m‚ñÑ[38;2;201;117;36m‚ñÖ[38;2;183;114;47m‚ñÖ[38;2;147;100;48m‚ñá[0m[38;2;9;7;4m     [7m[38;2;76;72;71m‚ñÜ[38;2;116;115;116m‚ñÑ[0m[38;2;115;114;111m‚ñò [0m
 [38;2;92;91;90m‚ñù[7m[38;2;115;112;113m‚ñÖ[0m[38;2;114;110;110m‚ñó[7m[38;2;133;131;134m‚ñÅ[0m[38;2;138;135;138m‚ñò                    [0m[?25h"



# conta le righe dell'immagine
IMAGE_HEIGHT=$(echo "$IMAGE" | wc -l)
SYSINFO_COUNT=${#SYSINFO[@]}

# calcola l'offset per centrare le specifiche
OFFSET=$(( (IMAGE_HEIGHT - SYSINFO_COUNT) / 2 ))

# inizializza array FETCH
FETCH=()

# accumula in FETCH
i=0
while IFS= read -r line; do
  if [ $i -ge $OFFSET ] && [ $i -lt $((OFFSET + SYSINFO_COUNT)) ]; then
    FETCH+=("$line${SYSINFO[$((i - OFFSET))]}")
  else
    FETCH+=("$line")
  fi
  i=$((i + 1))
done <<< "$IMAGE"



# nascondi cursore
printf '\e[?25l'

# ritardo
delay=0.002

cursor=$'\e[0m‚ñë‚ñë‚ñí‚ñì'

# tokenizza una riga in escape CSI + caratteri singoli
tokenize() {
  local s=$1; local -n T=$2
  T=()
  while [[ -n $s ]]; do
    if [[ $s =~ ^(\[[0-9;]*m)(.*) ]]; then
      T+=( "${BASH_REMATCH[1]}" )
      s=${BASH_REMATCH[2]}
    else
      T+=( "${s:0:1}" )
      s=${s:1}
    fi
  done
}

print_with_cursor() {
  local line=$1
  local -a tokens
  local prefix=""  # qui accumulo in ordine escape+testo
  tokenize "$line" tokens

  for tok in "${tokens[@]}"; do
    prefix+="$tok"
    # se √® carattere visibile (non inizio con ESC[), faccio il frame
    if [[ ! $tok =~ ^\[ ]]; then
      printf '\r%s%s\e[K' "$prefix" "$cursor"
      read -t "$delay"
    fi
  done

  # frame finale (tutta la riga senza cursor)
  printf '\r%s\e[K\n' "$prefix"
}

# stampa a schermo
for L in "${FETCH[@]}"; do
  print_with_cursor "$L"
done

# ripristina cursore
printf '\e[?25h'
