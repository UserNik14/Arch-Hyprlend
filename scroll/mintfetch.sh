#!/bin/bash
#
#
#



## COLORS

if [ -x "$(command -v tput)" ]; then
	bold="$(tput bold 2> /dev/null)"
	black="$(tput setaf 0 2> /dev/null)"
	red="$(tput setaf 1 2> /dev/null)"
	green="$(tput setaf 2 2> /dev/null)"
	yellow="$(tput setaf 3 2> /dev/null)"
	blue="$(tput setaf 4 2> /dev/null)"
	magenta="$(tput setaf 5 2> /dev/null)"
	cyan="$(tput setaf 6 2> /dev/null)"
	white="$(tput setaf 7 2> /dev/null)"
	reset="$(tput sgr0 2> /dev/null)"
fi

label="${reset}${bold}${blue}"



## RAM

# il primo argomento dello script pu√≤ essere MiB oppure GiB
UNIT="${1:-MiB}"  # se non viene passato nulla, usa MiB di default

read RAM_USED RAM_TOTAL <<< $(free -m | awk '/^Mem:/ {print $3, $2}')

# calcola la percentuale
PERC=$(( RAM_USED * 100 / RAM_TOTAL ))

# converte da MiB a GiB
if [[ "$UNIT" == "GiB" ]]; then
    RAM_USED=$(printf '%.2f\n' $((10**2*$RAM_USED/1024))e-2)
    RAM_TOTAL=$(printf '%.2f\n' $((10**2*$RAM_TOTAL/1024))e-2)
fi



## SYSTEM INFO

SYSINFO=(
"${reset}${bold}         __  ____      __"
"${reset}${bold}        /  |/  (_)__  / /_"
"${reset}${bold}       / /|_/ / / _ \\/ __/"
"${reset}${bold}      /_/  /_/_/_//_/\\__/"
"${reset}${bold}    ÔëõÔëõ ÔëõÔëõ ÔëõÔëõ ÔëõÔëõ ÔëõÔëõ ÔëõÔëõ ÔëõÔëõ ÔëõÔëõ"
" ${label}Kernel:${reset}    $(uname -sr)"
"  ${label}Ram:${reset}       $(printf "%s/%s %s (%d%%)" "$RAM_USED" "$RAM_TOTAL" "$UNIT" "$PERC")"
"   ${label}Uptime:${reset}    $(uptime -p | sed 's/up //')"
"    ${label}Packages:${reset}  $(dpkg-query -l | grep '^ii' | wc -l)"
""
""
""
)



## PRINT OUTPUT

#read -r rows cols < <(stty size)
#echo "Numero di righe: $rows"
#echo "Numero di colonne: $cols"

if [ $(tput lines) -lt 13 ]; then
        for info in "${SYSINFO[@]:0:4}"; do
          echo "  $info"
        done
        exit
fi

if [ $(tput lines) -lt 18 ]; then
        for info in "${SYSINFO[@]:0:8}"; do
          echo "  $info"
        done
        exit
fi

#if [ -z "$DISPLAY" ] && [ -z "$WAYLAND_DISPLAY" ] || [ $(tput cols) -lt 68 ]; then
if [ "$XDG_SESSION_TYPE" = "tty" ] || [ $(tput cols) -lt 68 ]; then
	for info in "${SYSINFO[@]}"; do
	  echo "  $info"
	done
	exit
fi


IMAGE="[?25l[0m [38;2;0;0;0m     [0m [38;2;191;191;191m‚ñÇ[38;2;221;221;221m‚ñÑ[38;2;247;247;247m‚ñÖ[38;2;253;253;253m‚ñÜ‚ñá[38;2;255;255;255;48;2;170;170;170m‚ñá[48;2;243;243;243m‚ñá‚ñá[48;2;171;171;171m‚ñá[0m[38;2;253;253;253m‚ñá‚ñÜ[38;2;247;247;247m‚ñÖ[38;2;221;221;221m‚ñÑ[38;2;191;191;191m‚ñÇ[0m [38;2;14;14;14m      [0m
 [38;2;0;0;0m   [38;2;136;136;136m‚ñÇ[38;2;243;243;243m‚ñÑ[38;2;248;248;248m‚ñá[38;2;243;248;242;48;2;255;255;255m‚ñÅ[38;2;137;195;106;48;2;251;253;251m‚ñÇ[38;2;122;189;86;48;2;253;254;253m‚ñÑ[38;2;109;183;69;48;2;247;250;245m‚ñÖ[38;2;107;181;65;48;2;243;248;242m‚ñÜ[38;2;110;183;70;48;2;254;254;254m‚ñá[38;2;105;181;63;48;2;235;243;233m‚ñá‚ñá[38;2;110;183;70;48;2;254;254;254m‚ñá[38;2;107;181;65;48;2;243;248;242m‚ñÜ[38;2;109;183;69;48;2;246;250;245m‚ñÖ[38;2;122;189;86;48;2;253;254;253m‚ñÑ[38;2;137;195;106;48;2;251;253;251m‚ñÇ[38;2;243;248;242;48;2;255;255;255m‚ñÅ[0m[38;2;248;248;248m‚ñá[38;2;243;243;243m‚ñÑ[38;2;136;136;136m‚ñÇ    [0m
 [38;2;0;0;0m [0m [38;2;226;226;226m‚ñÖ[38;2;255;255;255;48;2;234;234;234m‚ñá[38;2;191;222;175;48;2;253;254;253m‚ñÇ[38;2;114;185;76;48;2;231;243;226m‚ñÑ[38;2;109;183;68;48;2;188;220;172m‚ñá[48;2;105;181;63m            [48;2;188;220;172m‚ñá[38;2;114;185;76;48;2;231;243;226m‚ñÑ[38;2;191;222;175;48;2;253;254;253m‚ñÇ[38;2;255;255;255;48;2;234;234;234m‚ñá[0m[38;2;226;226;226m‚ñÖ[0m [38;2;84;84;84m  [0m
 [38;2;191;191;191m‚ñó[38;2;155;155;155;48;2;255;255;255m‚ñò[38;2;242;248;240m‚ñÅ[38;2;132;194;99;48;2;231;243;225m‚ñÑ[38;2;106;181;64;48;2;138;196;107m‚ñá[38;2;248;248;248;48;2;130;192;98m‚ñó[38;2;236;241;234;48;2;105;181;63m‚ñÖ[38;2;248;248;248;48;2;117;185;80m‚ññ[48;2;105;181;63m    [38;2;108;182;68m‚ñÅ‚ñÅ   [38;2;111;183;74m‚ñÅ   [38;2;106;181;64;48;2;138;196;107m‚ñá[38;2;132;194;99;48;2;231;243;225m‚ñÑ[38;2;242;248;240;48;2;255;255;255m‚ñÅ[38;2;155;155;155m‚ñù[0m[38;2;191;191;191m‚ññ [0m
[38;2;131;131;131m‚ñó[38;2;187;187;187;48;2;255;255;255m‚ñò[38;2;255;255;255;48;2;246;250;245m‚ñâ[38;2;244;249;241;48;2;126;191;91m‚ñò[48;2;105;181;63m  [38;2;123;188;89;48;2;248;248;248m‚ñç [38;2;248;248;248;48;2;118;186;83m‚ñå[48;2;105;181;63m [38;2;106;181;64m‚ï≤[38;2;212;231;203;48;2;115;185;77m‚ñÑ[38;2;246;247;246;48;2;152;202;127m‚ñÜ[38;2;248;248;248;48;2;231;238;228m‚ñá[48;2;229;238;227m‚ñá[38;2;246;247;246;48;2;150;201;124m‚ñÜ[38;2;237;242;235;48;2;119;187;82m‚ñÜ[38;2;248;248;248;48;2;190;218;178m‚ñá[48;2;245;246;245m‚ñá[38;2;246;247;246;48;2;156;203;135m‚ñá[38;2;234;241;230;48;2;122;189;87m‚ñÖ[38;2;151;202;124;48;2;105;181;63m‚ññ  [38;2;244;249;241;48;2;126;191;91m‚ñù[38;2;246;250;245;48;2;255;255;255m‚ñè[38;2;186;186;186m‚ñù[0m[38;2;131;131;131m‚ññ[0m
[7m[38;2;239;239;239m‚ñç[0m[38;2;53;53;53;48;2;255;255;255m [38;2;248;251;247;48;2;142;198;111m‚ñå[48;2;105;181;63m   [38;2;123;188;89;48;2;248;248;248m‚ñç [38;2;248;248;248;48;2;118;186;83m‚ñå[48;2;105;181;63m [38;2;109;182;70;48;2;228;238;224m‚ñä[48;2;248;248;248m [38;2;248;248;248;48;2;202;224;195m‚ñâ[38;2;116;186;79;48;2;240;243;238m‚ñá[48;2;239;243;238m‚ñá[38;2;202;224;195;48;2;248;248;248m‚ñè [38;2;233;240;230;48;2;139;196;108m‚ñç[38;2;106;181;65;48;2;231;238;229m‚ñá[38;2;119;186;84;48;2;232;240;228m‚ññ[48;2;248;248;248m [38;2;240;244;238;48;2;114;184;77m‚ñã[48;2;105;181;63m   [38;2;142;198;111;48;2;248;251;247m‚ñå[48;2;255;255;255m [0m[38;2;239;239;239m‚ñã[0m
[38;2;159;159;159;48;2;255;255;255m‚ñè [38;2;244;248;242;48;2;110;183;70m‚ñé[48;2;105;181;63m   [38;2;123;188;89;48;2;248;248;248m‚ñç [38;2;248;248;248;48;2;118;186;83m‚ñå[48;2;105;181;63m [38;2;114;184;76;48;2;248;248;248m‚ñä [38;2;248;248;248;48;2;158;201;142m‚ñâ[48;2;105;181;63m  [38;2;158;200;142;48;2;248;248;248m‚ñè [38;2;248;248;248;48;2;114;184;76m‚ñé[48;2;105;181;63m [38;2;118;186;83;48;2;248;248;248m‚ñå [38;2;248;248;248;48;2;123;188;89m‚ñã[48;2;105;181;63m   [38;2;110;183;70;48;2;244;248;242m‚ñä[48;2;255;255;255m [38;2;255;255;255;48;2;159;159;159m‚ñâ[0m
[38;2;159;159;159;48;2;255;255;255m‚ñè [38;2;244;248;242;48;2;110;183;70m‚ñé[48;2;105;181;63m   [38;2;123;188;89;48;2;248;248;248m‚ñç [38;2;248;248;248;48;2;118;186;83m‚ñå[48;2;105;181;63m [38;2;114;184;76;48;2;248;248;248m‚ñä [38;2;248;248;248;48;2;158;201;142m‚ñâ[48;2;105;181;63m  [38;2;158;200;142;48;2;248;248;248m‚ñè [38;2;248;248;248;48;2;114;184;76m‚ñé[48;2;105;181;63m [38;2;118;186;83;48;2;248;248;248m‚ñå [38;2;248;248;248;48;2;123;188;89m‚ñã[48;2;105;181;63m   [38;2;110;183;70;48;2;244;248;242m‚ñä[48;2;255;255;255m [38;2;255;255;255;48;2;159;159;159m‚ñâ[0m
[7m[38;2;239;239;239m‚ñç[0m[38;2;53;53;53;48;2;255;255;255m [38;2;248;251;247;48;2;142;198;111m‚ñå[48;2;105;181;63m   [38;2;114;184;77;48;2;243;245;242m‚ñç[48;2;248;248;248m [38;2;238;242;236;48;2;122;189;86m‚ñã[48;2;105;181;63m [38;2;168;209;146m‚ñù[38;2;105;181;63;48;2;246;247;246m‚ñÖ[48;2;235;241;233m‚ñÖ[48;2;105;181;63m  [48;2;235;241;233m‚ñÖ[48;2;246;247;246m‚ñÖ[38;2;168;209;146;48;2;105;181;63m‚ñò [38;2;122;188;86;48;2;238;242;236m‚ñç[48;2;248;248;248m [38;2;243;245;242;48;2;114;184;77m‚ñã[48;2;105;181;63m   [38;2;142;198;111;48;2;248;251;247m‚ñå[48;2;255;255;255m [0m[38;2;239;239;239m‚ñã[0m
[38;2;131;131;131m‚ñù[38;2;186;186;186;48;2;255;255;255m‚ññ[38;2;255;255;255;48;2;246;250;245m‚ñâ[38;2;244;249;241;48;2;126;191;91m‚ññ[48;2;105;181;63m  [38;2;185;218;169m‚ñù[38;2;163;207;141;48;2;244;246;243m‚ññ[38;2;247;247;246;48;2;248;248;248m‚ï±[38;2;239;243;237;48;2;130;192;97m‚ñÜ[38;2;235;241;233;48;2;105;181;63m‚ñÖ[38;2;248;248;248;48;2;121;187;86m‚ñÑ‚ñÑ‚ñÑ‚ñÑ‚ñÑ‚ñÑ[38;2;235;241;233;48;2;105;181;63m‚ñÖ[38;2;239;244;237;48;2;130;192;97m‚ñÜ[38;2;247;247;246;48;2;248;248;248m‚ï≤[38;2;163;207;141;48;2;244;246;243m‚ñó[38;2;185;218;169;48;2;105;181;63m‚ñò  [38;2;244;249;241;48;2;126;191;91m‚ñó[38;2;246;250;245;48;2;255;255;255m‚ñè[38;2;186;186;186m‚ñó[0m[38;2;131;131;131m‚ñò[0m
 [38;2;191;191;191m‚ñù[38;2;155;155;155;48;2;255;255;255m‚ññ[38;2;255;255;255;48;2;242;248;240m‚ñá[38;2;231;243;225;48;2;132;194;99m‚ñÑ[38;2;138;196;107;48;2;106;181;64m‚ñÅ[48;2;105;181;63m [38;2;105;181;63;48;2;116;185;80m‚ñá[38;2;112;184;73;48;2;227;238;223m‚ñÜ[38;2;106;182;65;48;2;238;243;237m‚ñÑ[38;2;105;181;63;48;2;234;240;231m‚ñÉ[48;2;236;241;234m‚ñÉ‚ñÉ‚ñÉ‚ñÉ‚ñÉ‚ñÉ[48;2;234;240;231m‚ñÉ[38;2;106;182;65;48;2;238;243;237m‚ñÑ[38;2;112;184;73;48;2;227;238;223m‚ñÜ[38;2;105;181;63;48;2;116;185;80m‚ñá[48;2;105;181;63m [38;2;138;196;107;48;2;106;181;64m‚ñÅ[38;2;231;243;225;48;2;132;194;99m‚ñÑ[38;2;255;255;255;48;2;243;248;240m‚ñá[38;2;155;155;155;48;2;255;255;255m‚ñó[0m[38;2;191;191;191m‚ñò [0m
 [38;2;0;0;0m [0m [7m[38;2;226;226;226m‚ñÉ[0m[38;2;234;234;234;48;2;255;255;255m‚ñÅ[38;2;253;254;253;48;2;191;222;175m‚ñÜ[38;2;231;243;226;48;2;114;185;76m‚ñÑ[38;2;188;220;172;48;2;109;183;68m‚ñÅ[48;2;105;181;63m            [48;2;109;183;68m‚ñÅ[38;2;231;243;226;48;2;114;185;76m‚ñÑ[38;2;253;254;253;48;2;191;222;175m‚ñÜ[38;2;234;234;234;48;2;255;255;255m‚ñÅ[0m[7m[38;2;226;226;226m‚ñÉ[0m [38;2;84;84;84m  [0m
 [38;2;0;0;0m   [7m[38;2;136;136;136m‚ñÜ[38;2;243;243;243m‚ñÑ[38;2;248;248;248m‚ñÅ[0m[38;2;255;255;255;48;2;243;248;242m‚ñá[38;2;251;253;251;48;2;137;195;106m‚ñÜ[38;2;253;254;253;48;2;122;189;86m‚ñÑ[38;2;247;250;245;48;2;109;183;69m‚ñÉ[38;2;243;248;242;48;2;107;181;65m‚ñÇ[38;2;254;254;254;48;2;110;183;70m‚ñÅ[38;2;235;243;233;48;2;105;181;63m‚ñÅ‚ñÅ[38;2;254;254;254;48;2;110;183;70m‚ñÅ[38;2;243;248;242;48;2;107;181;65m‚ñÇ[38;2;246;250;245;48;2;109;183;69m‚ñÉ[38;2;253;254;253;48;2;122;189;86m‚ñÑ[38;2;251;253;251;48;2;137;195;106m‚ñÜ[38;2;255;255;255;48;2;243;248;242m‚ñá[0m[7m[38;2;248;248;248m‚ñÅ[38;2;243;243;243m‚ñÑ[38;2;136;136;136m‚ñÜ[0m[38;2;5;5;5m    [0m
 [38;2;0;0;0m     [0m [7m[38;2;191;191;191m‚ñÜ[38;2;221;221;221m‚ñÑ[38;2;247;247;247m‚ñÉ[38;2;253;253;253m‚ñÇ‚ñÅ[0m[38;2;170;170;170;48;2;255;255;255m‚ñÅ[38;2;243;243;243m‚ñÅ‚ñÅ[38;2;171;171;171m‚ñÅ[0m[7m[38;2;253;253;253m‚ñÅ‚ñÇ[38;2;247;247;247m‚ñÉ[38;2;221;221;221m‚ñÑ[38;2;191;191;191m‚ñÜ[0m [38;2;0;0;0m      [0m[?25h"



# conta le righe dell'immagine
IMAGE_HEIGHT=$(echo "$IMAGE" | wc -l)
SYSINFO_COUNT=${#SYSINFO[@]}

# calcola l'offset per centrare le specifiche
OFFSET=$(( (IMAGE_HEIGHT - SYSINFO_COUNT) / 2 ))

# inizializza array FETCH
FETCH=()

# accumula in FETCH
i=0
while IFS= read -r line; do
  if [ $i -ge $OFFSET ] && [ $i -lt $((OFFSET + SYSINFO_COUNT)) ]; then
    FETCH+=("$line ${SYSINFO[$((i - OFFSET))]}")
  else
    FETCH+=("$line")
  fi
  i=$((i + 1))
done <<< "$IMAGE"



# nascondi cursore
printf '\e[?25l'

# ritardo
delay=0.003

cursor=$'\e[0m‚ñë‚ñë‚ñí‚ñì'

# tokenizza una riga in escape CSI + caratteri singoli
tokenize() {
  local s=$1; local -n T=$2
  T=()
  while [[ -n $s ]]; do
    if [[ $s =~ ^(\[[0-9;]*m)(.*) ]]; then
      T+=( "${BASH_REMATCH[1]}" )
      s=${BASH_REMATCH[2]}
    else
      T+=( "${s:0:1}" )
      s=${s:1}
    fi
  done
}

print_with_cursor() {
  local line=$1
  local -a tokens
  local prefix=""  # qui accumulo in ordine escape+testo
  tokenize "$line" tokens

  for tok in "${tokens[@]}"; do
    prefix+="$tok"
    # se √® carattere visibile (non inizio con ESC[), faccio il frame
    if [[ ! $tok =~ ^\[ ]]; then
      printf '\r%s%s\e[K' "$prefix" "$cursor"
      read -t "$delay"
    fi
  done

  # frame finale (tutta la riga senza cursor)
  printf '\r%s\e[K\n' "$prefix"
}

# stampa a schermo
for L in "${FETCH[@]}"; do
  print_with_cursor "$L"
done

# ripristina cursore
printf '\e[?25h'
